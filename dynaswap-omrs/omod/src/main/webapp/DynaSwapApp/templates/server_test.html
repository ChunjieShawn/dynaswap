<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Server Test</title>
</head>
<body>
    <textarea id="chat-log" cols="100" rows="20"></textarea><br/>
    <input id="chat-message-input" type="text" size="100"/><br/>
    <input id="chat-message-submit" type="button" value="Send"/>
    <input id="request_z" type="button" value="Ask for z value" />
</body>
<script>

    var chatSocket = new WebSocket('ws://127.0.0.1:8000/ws/server_test/');
    var SID = null;

    chatSocket.onopen = function(e) {
        SID = localStorage.getItem("SID")
        // If there is no SID in storage request one
        if(SID === null){
            chatSocket.send(JSON.stringify({
                'action': 'request_SID'
            }))
        }
    }

    chatSocket.onmessage = function(e) {
        var data = JSON.parse(e.data);
        let logEl = document.querySelector('#chat-log');
        // var message = data['message'];
        // document.querySelector('#chat-log').value += (message + '\n');
        if (data['action'] === "receive_z"){
            logEl.value += (data['data'] + "\n");
        } else if (data['action'] === 'receive_SID'){
            localStorage.setItem("SID", data['SID']);
            logEl.value += ("SID: " + data['SID'] + "\n");
        }

    };

    chatSocket.onclose = function(e) {
        console.error('Chat socket closed unexpectedly');
    };

    document.querySelector('#chat-message-input').focus();
    document.querySelector('#chat-message-input').onkeyup = function(e) {
        if (e.keyCode === 13) {  // enter, return
            document.querySelector('#chat-message-submit').click();
        }
    };

    document.querySelector('#chat-message-submit').onclick = function(e) {
        var messageInputDom = document.querySelector('#chat-message-input');
        var message = messageInputDom.value;
        chatSocket.send(JSON.stringify({
            'message': message
        }));

        messageInputDom.value = '';
    };

    document.querySelector('#request_z').onclick = function(e){
        chatSocket.send(JSON.stringify({
            'action': 'request_z',
            'data': ''
        }))
    };

    testObj = '[1, -5, 2]';
    z = 13;

    function calcSecretKey(coefficientObj, xInt, zInt){
        let coefficientList = JSON.parse(coefficientObj);
        console.log(coefficientList);
        let startingExponentNum = coefficientList.length-1
        let sum = 0;
        coefficientList.forEach((coefficient) => {
            coefficientNum = parseInt(coefficient);
            if(startingExponentNum > 0){
                sum += (coefficientNum * Math.pow(xInt, startingExponentNum));
            } else{
                sum += coefficientNum;
            }
            startingExponentNum -= 1;
        });
        
        // Want to be able to get a positive number when modding a negative
        if(sum < 0){
            return (sum % zInt) + zInt;
        } else {
            return sum % zInt;
        }
    }
    console.log(calcSecretKey(testObj, 4, z));
    
    
</script>
</html>